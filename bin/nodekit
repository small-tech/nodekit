#!/usr/bin/env bash

set -e

# Production and development modes have separate loader and main processes.
# (Production mode is far simpler and is kept separate for security and 
# maintenability reasons.)

if [ ! -z "$PRODUCTION" ]; then
  # Production mode
  QUIET=true NODE_OPTIONS='--require=./suppress-experimental.cjs' node \
    --enable-source-maps --experimental-modules --experimental-specifier-resolution=node \
    --experimental-vm-modules --experimental-loader \
    ./production/processes/loader.js ./production/processes/main.js "$@"
else
  # Development mode
  QUIET=true NODE_OPTIONS='--require=./suppress-experimental.cjs' node \
    --enable-source-maps --experimental-modules --experimental-specifier-resolution=node \
    --experimental-vm-modules --experimental-loader \
    ./development/processes/loader.js ./development/processes/main.js "$@"
fi

